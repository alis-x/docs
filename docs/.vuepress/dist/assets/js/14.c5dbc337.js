(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{461:function(t,s,e){"use strict";e.r(s);var a=e(35),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"build-your-first-product"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#build-your-first-product"}},[t._v("#")]),t._v(" Build your first product")]),t._v(" "),e("blockquote",[e("p",[t._v("üëâ In this section, you will build your first product on "),e("strong",[t._v("alis.exchange")]),t._v(" to get a feel for how everything you have installed and read comes together.")])]),t._v(" "),e("p",[t._v("A few final things before we get started. This section assumes you have successfully "),e("RouterLink",{attrs:{to:"/guides/configuration/command-line-interface.html"}},[t._v("installed the CLI")]),t._v(" and "),e("RouterLink",{attrs:{to:"/guides/configuration/set-up-your-favourite-IDE.html"}},[t._v("set up your IDE")]),t._v(".")],1),t._v(" "),e("p",[t._v("The purpose of this is to get you building. The story and everything around it is fictitious and very obviously flawed in business logic. We put a story around it for it to flow, please don't try and reason out the story.")]),t._v(" "),e("p",[t._v("This example attempts to structure content in a way that provides:"),e("br"),t._v("\nüé• "),e("strong",[t._v("Context")]),t._v(" - the story we are following and what we aim to achieve."),e("br"),t._v("\nüèÉ‚Äç‚ôÇ "),e("strong",[t._v("Execution")]),t._v(" - the actual things that you will need to do."),e("br"),t._v("\nü§ì "),e("strong",[t._v("Breakdown")]),t._v(" - a high-level explanation of what you did and what happened in the background.")]),t._v(" "),e("p",[t._v("Let's go!")]),t._v(" "),e("h2",{attrs:{id:"help-play-grow-10x"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#help-play-grow-10x"}},[t._v("#")]),t._v(" Help Play grow 10x")]),t._v(" "),e("h3",{attrs:{id:"üé•-story-time"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#üé•-story-time"}},[t._v("#")]),t._v(" üé• Story time")]),t._v(" "),e("p",[t._v("A group of friends decided to start a company called "),e("code",[t._v("Play")]),t._v(" after a discovery in their parents' cupboard led to a set of\nbusiness ideas. Two of the founders were unpacking a cupboard when they came across an external hard drive that contained\na large number of eBooks their parents purchased in the mid 2000s. Mike, who always seems to come up with an idea of\nmaking money, suggested that they could start some online store with these books and acquire additional books as time\ngoes on.")]),t._v(" "),e("p",[t._v("Having some experience in software, James suggested that they build out a set of products, each trying to provide a\nwell-defined value offering and solving specific problems. Having previously built on "),e("strong",[t._v("alis.exchange")]),t._v(", it was an\nobvious decision to register their new-found company, Play, on the exchange. They decided to start by creating a book\nrepository product,"),e("code",[t._v("ME")]),t._v(", which defines a "),e("code",[t._v("book")]),t._v(" resource and keeps track of all the books that they have available. This is the product considered in the "),e("RouterLink",{attrs:{to:"/docs/guides/make-your-first-request.html"}},[t._v("make a request to a product guide")]),t._v(".")],1),t._v(" "),e("p",[t._v("At this point in time, they already have an organisation on "),e("strong",[t._v("alis.exchange")]),t._v(" with their core product "),e("code",[t._v("ME")]),t._v(". They have given\ntheir employees freedom to experiment with products, simply ignore these in the repos.")]),t._v(" "),e("h3",{attrs:{id:"üèÉ‚Äç‚ôÇ-ex-1-orientate-yourself"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#üèÉ‚Äç‚ôÇ-ex-1-orientate-yourself"}},[t._v("#")]),t._v(" üèÉ‚Äç‚ôÇ Ex 1: Orientate yourself")]),t._v(" "),e("p",[t._v("Since the organisation and product already exists, you will need to "),e("code",[t._v("get")]),t._v(" these on your device.")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("From your terminal, run "),e("code",[t._v("alis org get play")]),t._v(".")]),t._v(" "),e("blockquote",[e("p",[t._v("ü§ì This adds the "),e("code",[t._v("play")]),t._v(" directory into the "),e("code",[t._v("alis.exchange")]),t._v(" folder in your "),e("code",[t._v("HOME")]),t._v(" directory. You can open this to\nsee the various directories that become available. Check out the explanation of how the "),e("RouterLink",{attrs:{to:"/docs/references/local-folder-structure.html"}},[t._v("alis.exchange folder hierarchy is set up")]),t._v(" to understand what the purpose of each directory is.")],1)])]),t._v(" "),e("li",[e("p",[t._v("Open the "),e("code",[t._v("/proto")]),t._v(" directory in your IDE.")])]),t._v(" "),e("li",[e("p",[t._v("Navigate to "),e("code",[t._v("proto/play/br/resources/books/v1/")]),t._v(" to see the definition of the "),e("code",[t._v("book")]),t._v(" resource and all the methods available for the API.")])])]),t._v(" "),e("h3",{attrs:{id:"üé•-the-design-requirements"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#üé•-the-design-requirements"}},[t._v("#")]),t._v(" üé• The design requirements")]),t._v(" "),e("p",[t._v("The founders at "),e("code",[t._v("Play")]),t._v(" have decided to create a new Administrative product, "),e("code",[t._v("ad")]),t._v(", that coordinates the loans of books by various users.")]),t._v(" "),e("p",[t._v("The product has already been created on "),e("strong",[t._v("alis.exchange")]),t._v(" and simply requires you to build it out. If you are interested in the process around how a product is created, open the section below.")]),t._v(" "),e("details",{staticClass:"custom-block details"},[e("summary",[t._v("ü§ì ad product creation on alis.exchange")]),t._v(" "),e("p",[t._v("The process of creating a product is facilitated through the "),e("strong",[t._v("alis.exchange")]),t._v(" CLI. The following sections breaks down the actions that was followed by "),e("code",[t._v("play")]),t._v(" to create a product and a brief overview of what happened in the background.")]),t._v(" "),e("h4",{attrs:{id:"actions-executed"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#actions-executed"}},[t._v("#")]),t._v(" Actions executed")]),t._v(" "),e("ol",[e("li",[t._v("In the terminal, the command "),e("code",[t._v("alis product create play.ad")]),t._v(" was run. You can run "),e("code",[t._v("alis product create -h")]),t._v(" to get information on the command")]),t._v(" "),e("li",[t._v("The prompts were followed that required the user to specify:\n"),e("ul",[e("li",[t._v("Display name for the product")]),t._v(" "),e("li",[t._v("Owner of the product")]),t._v(" "),e("li",[t._v("Product description")]),t._v(" "),e("li",[t._v("Billing account for the product")])])]),t._v(" "),e("li",[t._v("To initialise the product repo, a simple "),e("code",[t._v(".gitignore")]),t._v(" file was commited and pushed.")])]),t._v(" "),e("p",[t._v("Simple right? In the background, a lot of heavy lifting was done. The following section provides an overview thereof.")]),t._v(" "),e("h4",{attrs:{id:"ü§ì-overview-of-background-processes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ü§ì-overview-of-background-processes"}},[t._v("#")]),t._v(" ü§ì Overview of background processes")]),t._v(" "),e("p",[t._v("While the CLI was displaying a spinner:")]),t._v(" "),e("ul",[e("li",[t._v("A Google Cloud project that hosts the product was created within the play organisation.")]),t._v(" "),e("li",[t._v("An empty Google Cloud Source Repository was created for the "),e("code",[t._v("ad")]),t._v(" product.")]),t._v(" "),e("li",[t._v("Various permissions was added for the specified owner of the product in order to control access for clients and developers.")]),t._v(" "),e("li",[t._v("Various Terraform template files was added within "),e("code",[t._v("$HOME/alis.exchange/play/proto/play/ad")]),t._v(" that are used to manage the cloud infrastructure of your product. These Terraform files collectively specifies all the cloud infrastructure that needs to be configured for your product to work, such as enabling various APIs (Cloud Run, Firestore, etc.) and creating permission groups.")])])]),t._v(" "),e("p",[t._v("In order to coordinate the loans of books by various users, they firstly require a "),e("code",[t._v("receipt")]),t._v(" resource.")]),t._v(" "),e("p",[t._v("The use case is as follows: when a client takes out one or more books, a receipt is created that keeps track of various\ninformation such as who client is, which books were borrowed, the date the books were borrowed and the required return date.")]),t._v(" "),e("p",[t._v("Knowing that people often forget when books are due for return, they also require a "),e("code",[t._v("notification")]),t._v(" service which sends\na reminder to clients about the books required for return, at the specified date.")]),t._v(" "),e("p",[t._v("As part of this example, we will be a "),e("code",[t._v("receipt")]),t._v(" resource neuron within a new product along with and a "),e("code",[t._v("notification")]),t._v(" service.\nneuron.")]),t._v(" "),e("details",{staticClass:"custom-block details"},[e("summary",[t._v("ü§ì What is a neuron?")]),t._v(" "),e("p",[t._v("A neuron is a collection of one or more APIs that performs a well defined function, such as interacting with a resource, executing a service or handling an event, by leveraging a collection of cloud resources.")]),t._v(" "),e("p",[t._v("In the case of our "),e("code",[t._v("receipt")]),t._v(" neuron, the neuron will be providing an API to perform actions (create, update, get) on a "),e("code",[t._v("receipt")]),t._v(" resource by leveraging cloud resources including Google Cloud Run, Firestore and IAM.")])]),t._v(" "),e("h3",{attrs:{id:"üèÉ‚Äç‚ôÇ-overview-of-the-process"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#üèÉ‚Äç‚ôÇ-overview-of-the-process"}},[t._v("#")]),t._v(" üèÉ‚Äç‚ôÇ Overview of the process")]),t._v(" "),e("p",[t._v("The common process followed when building out new aspects of a product is depicted below\n")]),t._v(" "),e("h3",{attrs:{id:"üèÉ‚Äç‚ôÇ-create-resource-neuron"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#üèÉ‚Äç‚ôÇ-create-resource-neuron"}},[t._v("#")]),t._v(" üèÉ‚Äç‚ôÇ Create resource neuron")]),t._v(" "),e("h4",{attrs:{id:"üèÉ‚Äç‚ôÇ-ex-2-create-resource-neuron-using-terminal"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#üèÉ‚Äç‚ôÇ-ex-2-create-resource-neuron-using-terminal"}},[t._v("#")]),t._v(" üèÉ‚Äç‚ôÇ Ex 2: Create resource neuron using terminal")]),t._v(" "),e("p",[t._v("Creating a neuron requires the specification of a resource ID, which follows the convention:\n- "),e("code",[t._v("resources-{resourceName}-{majorVersion} for resources -")]),t._v("services-{serviceName}-{majorVersion} for services")]),t._v(" "),e("p",[t._v("In our example, we would usually have specified the "),e("code",[t._v("receipts")]),t._v(" resource as "),e("code",[t._v("resources-receipts-v1")]),t._v(". However, since we are reusing this product as a playground for multiple users, we ask that you add a unique ending to the resource, such as adding your initials. Eg. "),e("code",[t._v("resources-receipts-v1")]),t._v(".")]),t._v(" "),e("ol",[e("li",[t._v("From your terminal, run the command "),e("code",[t._v("alis neuron create play.ad."+t._s(t.yourResourceID))]),t._v(", specifying your unique resource ID.")])]),t._v(" "),e("blockquote",[e("p",[t._v("ü§ì In the background, the CLI created neuron directories with various template files. These will make more sense as we start using them but to know at this stage:"),e("br")]),t._v(" "),e("ul",[e("li",[t._v("Inside the "),e("code",[t._v("$HOME/alis.exchange/play/proto/play/ad/resources/{resourceName}/v1")]),t._v(" directory, a "),e("code",[t._v("service.proto")]),t._v(" and various Terraform ("),e("code",[t._v("*.tf")]),t._v(") files were added;")]),t._v(" "),e("li",[t._v("Inside the "),e("code",[t._v("$HOME/alis.exchange/play/products/ad/resources/{resourceName}/v1")]),t._v(" directory, various Go ("),e("code",[t._v("*.go")]),t._v(") template files were added that will be used for implementing the code as well as a Dockerfile that is used to containerize your source code.")])])]),t._v(" "),e("h4",{attrs:{id:"üèÉ‚Äç‚ôÇ-ex-3-define-the-resource-and-methods"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#üèÉ‚Äç‚ôÇ-ex-3-define-the-resource-and-methods"}},[t._v("#")]),t._v(" üèÉ‚Äç‚ôÇ Ex 3: Define the resource and methods")]),t._v(" "),e("blockquote",[e("p",[t._v("ü§ì A high-level understanding of the proto file structure and the comments on the various aspects of the file content\nshould be sufficient to orientate you around the following steps.")])]),t._v(" "),e("p",[t._v("‚ÄºÔ∏è The full proto used in this example can be "),e("a",{attrs:{href:"/docs//guides//build-your-first-product/src/receipts/receipts.proto"}},[t._v("found in the repo")]),t._v(". Be careful when copying over content that you "),e("strong",[t._v("DO NOT")]),t._v(" change the "),e("code",[t._v("package")]),t._v(" name (yours should be "),e("code",[t._v("package play.ad.resources.{yourResourceName}.v1;")]),t._v(") or the "),e("code",[t._v("option go_package")]),t._v(" specification (yours should be "),e("code",[t._v('option go_package = "go.protobuf.play.alis.exchange/play/ad/resources/{yourResourceName}/v1";')]),t._v(")")]),t._v(" "),e("p",[t._v("The following steps will run through some important aspects of the proto.")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("Ensure that the following "),e("em",[t._v("imports")]),t._v(" are included at the top of the proto:")]),t._v(" "),e("div",{staticClass:"language-protobuf extra-class"},[e("pre",{pre:!0,attrs:{class:"language-protobuf"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"google/protobuf/empty.proto"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"google/api/resource.proto"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"google/api/field_behavior.proto"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"google/api/client.proto"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"google/api/annotations.proto"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"google/protobuf/timestamp.proto"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"google/protobuf/field_mask.proto"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"google/type/date.proto"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("blockquote",[e("p",[t._v("üö© If your IDE cannot find the imports, ensure that you:")]),t._v(" "),e("ul",[e("li",[t._v("Have run "),e("code",[t._v("alis org get google")]),t._v("; and")]),t._v(" "),e("li",[e("RouterLink",{attrs:{to:"/guides/configuration/set-up-your-favourite-IDE.html"}},[t._v("Configured your plugins correctly")]),t._v(".")],1)])])]),t._v(" "),e("li",[e("p",[t._v("In "),e("code",[t._v("receipts.proto")]),t._v(", define the "),e("code",[t._v("Receipt")]),t._v(" resource:")]),t._v(" "),e("div",{staticClass:"language-protobuf extra-class"},[e("pre",{pre:!0,attrs:{class:"language-protobuf"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//A receipt resource")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("message")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Receipt")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Name of the resource in the format:")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//receipts/{receipt}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" name "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("field_behavior"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" OUTPUT_ONLY"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//The email of the client.")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Example: bar@play.com")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" client "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("field_behavior"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" REQUIRED"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//The full names of the books taken out by the client.")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Format: books/{book}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("repeated")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" books "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("field_behavior"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" REQUIRED"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//The date the book was borrowed by the client.")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Date")]),t._v(" borrow_date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("field_behavior"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" OUTPUT_ONLY"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The date the book(s) is required to be returned")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Date")]),t._v(" required_return_date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("field_behavior"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" REQUIRED"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The date the book(s) was actually returned")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Date")]),t._v(" actual_return_date "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Now that we have defined the resource, we will add the "),e("a",{attrs:{href:"https://google.aip.dev/131",target:"_blank"}},[t._v("\nstandard methods")]),t._v(" on the resource.")]),t._v(" "),e("blockquote",[e("p",[t._v("ü§ì "),e("a",{attrs:{href:"https://google.aip.dev/131",target:"_blank"}},[t._v(" The AIP documentation on the standard methods")]),t._v(" provide\nan in-depth explanation of the best practices. "),e("br"),t._v("\nüö© Note that we will only be implementing the "),e("code",[t._v("create")]),t._v(" and "),e("code",[t._v("get")]),t._v(" methods in this example.")])]),t._v(" "),e("p",[t._v("Replace the "),e("code",[t._v("service Service{...}")]),t._v(" section with the following:")]),t._v(" "),e("div",{staticClass:"language-protobuf extra-class"},[e("pre",{pre:!0,attrs:{class:"language-protobuf"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("////  The receipt service")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The idea behind the service is that when a client takes out one")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// or more books, a receipt is created that keeps track of")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// various information.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("service")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReceiptsService")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create a new receipt")]),t._v("\n       "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// See: https://google.aip.dev/133")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rpc")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateReceipt")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CreateReceiptRequest")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Receipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("option")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("http"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            post"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/resources/receipts/v2/receipts"')]),t._v("\n            body"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"receipt"')]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("option")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method_signature"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"receipt"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Get an receipt")]),t._v("\n       "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// See: https://google.aip.dev/131")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rpc")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetReceipt")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GetReceiptRequest")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Receipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("option")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("http"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            get"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/resources/receipts/v2/{name=receipts/*}"')]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("option")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method_signature"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Define the "),e("code",[t._v("Request")]),t._v(" messages:")]),t._v(" "),e("div",{staticClass:"language-protobuf extra-class"},[e("pre",{pre:!0,attrs:{class:"language-protobuf"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Request message for CreateReceipt.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("message")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CreateReceiptRequest")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The Receipt to create")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[t._v("Receipt")]),t._v(" receipt "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("field_behavior"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" REQUIRED"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Request message for GetReceipt")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("message")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GetReceiptRequest")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The receipt name is the unique identifier across organisations.")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Format: receipts/{receipt}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" name "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("field_behavior"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" REQUIRED"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),e("h4",{attrs:{id:"üèÉ‚Äç‚ôÇ-ex-4-define-the-cloud-infrastructure-requirements"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#üèÉ‚Äç‚ôÇ-ex-4-define-the-cloud-infrastructure-requirements"}},[t._v("#")]),t._v(" üèÉ‚Äç‚ôÇ Ex 4: Define the Cloud Infrastructure requirements")]),t._v(" "),e("p",[t._v("Terraform is used to specify the infrastructure required for your neuron. "),e("strong",[t._v("alis.exchange")]),t._v(" provides various "),e("code",[t._v("*.tf")]),t._v(" file templates that are preconfigured for the majority of use cases. This includes the specifications of:")]),t._v(" "),e("ul",[e("li",[t._v("Cloud Run: Which is used to run the container of your neuron. The configuration includes the scaling specifications, naming of the instance, traffic and which container to run.")]),t._v(" "),e("li",[t._v("Identity and Access Managament (IAM): Which is used to restrict access to the neuron")]),t._v(" "),e("li",[t._v("Variables: Various environmental variables that are used to facilitate multiple deployment environments and dependencies on other products.")])]),t._v(" "),e("blockquote",[e("p",[t._v("üí° "),e("strong",[t._v("Tip:")]),t._v(" Scan through the "),e("code",[t._v("*.tf")]),t._v(" files along with the "),e("a",{attrs:{href:"https://www.terraform.io/intro",target:"_blank",rel:"noopener noreferrer"}},[t._v("Terraform Documentation"),e("OutboundLink")],1),t._v(" and the "),e("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/google/latest/docs",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google documentation on Terraform Registry"),e("OutboundLink")],1),t._v(" to understand what is being configured.")])]),t._v(" "),e("p",[t._v("When building your own neurons, you may bulk up your neurons with additional functionality by simply adding the Terraform specification for what you are trying to achieve. Examples may be adding:")]),t._v(" "),e("ul",[e("li",[t._v("A "),e("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/spanner_instance",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cloud Spanner Instance"),e("OutboundLink")],1),t._v(";")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/workflows_workflow",target:"_blank",rel:"noopener noreferrer"}},[t._v("Defining a Workflow"),e("OutboundLink")],1),t._v("; and")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/pubsub_topic",target:"_blank",rel:"noopener noreferrer"}},[t._v("Creating"),e("OutboundLink")],1),t._v(" or "),e("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/pubsub_subscription",target:"_blank",rel:"noopener noreferrer"}},[t._v("subscribing"),e("OutboundLink")],1),t._v(" to a PubSub topic.")])]),t._v(" "),e("h4",{attrs:{id:"üèÉ‚Äç‚ôÇ-ex-5-compile-the-proto-files-locally"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#üèÉ‚Äç‚ôÇ-ex-5-compile-the-proto-files-locally"}},[t._v("#")]),t._v(" üèÉ‚Äç‚ôÇ Ex 5: Compile the proto files locally")]),t._v(" "),e("blockquote",[e("p",[t._v("ü§ì In order to implement the gRPC server, or programmatically use the API, the "),e("code",[t._v(".proto")]),t._v(" files are compiled into files containing the service and message definitions for a specified language. In this example, we will be focussing on the implementation in Go.")])]),t._v(" "),e("p",[t._v("In your terminal, run the following command, specifying your neuron name:")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$ alis neuron genprotobuf play.ad.resources-"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("uniqueNeuronName"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("-v1\n")])])]),e("p",[t._v("This commands generates "),e("code",[t._v(".pb.go")]),t._v(" files locally in the "),e("code",[t._v("$HOME/alis.exchange/play/protobuf/go/*")]),t._v(" directory, following the path of the Neuron. The contents of these files are not necessary to understand, other than knowing that they contain the definitions for the Go language.")]),t._v(" "),e("blockquote",[e("p",[t._v("ü§ì Once we have finished implementing our API we will push these files to make them available for others to use.")])]),t._v(" "),e("h4",{attrs:{id:"üèÉ‚Äç‚ôÇ-ex-6-update-dependencies-required-to-implement-the-services"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#üèÉ‚Äç‚ôÇ-ex-6-update-dependencies-required-to-implement-the-services"}},[t._v("#")]),t._v(" üèÉ‚Äç‚ôÇ Ex 6: Update dependencies required to implement the services")]),t._v(" "),e("p",[t._v("When you ran "),e("code",[t._v("alis neuron create ...")]),t._v(" command, various template files were also added to the "),e("code",[t._v("ad")]),t._v(" product directory. These will make sense as we implement the server.")]),t._v(" "),e("ol",[e("li",[t._v("To find the definitions for your service, it is required to import the definitions which are specified with the "),e("code",[t._v("go.mod")]),t._v(" file. These imports, similar to other go packages, are pulled from an online environment. Since we are still building out the services, and have not yet pushed these definitions to an online environment (this will be done in step _______), we will use a "),e("code",[t._v("replace")]),t._v(" statement to point to the locally compiled files from the previous step.")])]),t._v(" "),e("p",[t._v("In your "),e("code",[t._v("go.mod")]),t._v(", uncomment the line similar to the one below:")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("replace go.protobuf.play.alis.exchange => ../../../../../../play/protobuf/go\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[t._v("Ensure that your terminal is open in the "),e("code",[t._v("v1")]),t._v(" directory containing the "),e("code",[t._v("go.mod")]),t._v(" file and run the command "),e("code",[t._v("go mod tidy")]),t._v(" to sync the dependencies.")])]),t._v(" "),e("h4",{attrs:{id:"üèÉ‚Äç‚ôÇ-ex-7-implement-the-services"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#üèÉ‚Äç‚ôÇ-ex-7-implement-the-services"}},[t._v("#")]),t._v(" üèÉ‚Äç‚ôÇ Ex 7: Implement the services")]),t._v(" "),e("blockquote",[e("p",[t._v("ü§ì In the "),e("code",[t._v("server.go")]),t._v(" file, we establish client connections with Google and other "),e("strong",[t._v("alis.exchange")]),t._v(" products during initialisation ("),e("code",[t._v("init()")]),t._v(") to make them accessible during run time. In the "),e("code",[t._v("main()")]),t._v(" section, we create and serve a gRPC server which implements the methods (done in "),e("code",[t._v("methods.go")]),t._v(") which were defined in the proto and was translated into the "),e("code",[t._v(".pb.go")]),t._v(" files.")])]),t._v(" "),e("ol",[e("li",[e("strong",[t._v("Establishing client connection during "),e("code",[t._v("init()")])])])]),t._v(" "),e("p",[t._v("The init section contains various boilerplate code, of which we can remove that which is not necessary, and add further connections. We want to create a connection with Firestore, which will store the details of our "),e("code",[t._v("receipts")]),t._v(", as well as to the "),e("code",[t._v("play.br")]),t._v(" product in order to get various book defintions.")]),t._v(" "),e("p",[t._v("Ensure that the section above your "),e("code",[t._v("main.go")]),t._v(" looks exactly like code below:")]),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"context"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"os"')]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cloud.google.com/go/firestore"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"google.golang.org/grpc"')]),t._v("\n\n\tpbBooks "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"go.protobuf.play.alis.exchange/play/br/resources/books/v1"')]),t._v("\n\tpb "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"go.protobuf.play.alis.exchange/play/ad/resources/receipts/v1"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// client is a global client, initialized once per cloud run instance.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\tfirestoreClient    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("firestore"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Client\n\tbooksClient       pbBooks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BooksServiceClient\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nffunc "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Pre-declare err to avoid shadowing.")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Disable log prefixes such as the default timestamp.")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Prefix text prevents the message from being parsed as JSON.")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// A timestamp is added when shipping logs to Cloud Logging.")]),t._v("\n\tlog"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetFlags")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Retrieve project id from the environment.")]),t._v("\n\tprojectID "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" os"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Getenv")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ALIS_OS_PROJECT"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" projectID "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlog"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fatal")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ALIS_OS_PROJECT env not set."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Initialise Firestore client")]),t._v("\n\tfirestoreClient"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" firestore"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewClient")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Background")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" projectID"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlog"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fatalf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"firestore.NewClient: %v"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Retrieve ME cloud run hash from the environment.")]),t._v("\n\tbrHash "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" os"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Getenv")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ALIS_OS_ME_CLOUDRUNHASH"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" brHash "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlog"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fatal")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ALIS_OS_PROJECT env not set."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create a connection with the gRPC server hosted on Cloud Run")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The URI of these services follows a consistent pattern:")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// {NeuronName}-{GoogleProjectCloudRunHash}-{region}.a.run.app:443")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The {GoogleProjectCloudRunHash} is not preemptable but is the same for all neurons")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// of a specific product deployment, ie. the same for all Cloud Run services in a Google Project.")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This therefore requires you to obtain the hash from the product that you are making use of.")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The {region} is the region in which the service is hosted. The default region")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// on alis.exchange is `ew`, ie. Europe-West. For more information on regions,")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// see: __________.")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" conn"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewConn")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Background")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"resources-books-v1-"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" brHash "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-ew.a.run.app:443"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlog"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fatalf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"booksClient new connection: %v"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// If the connection was succesfully established, instantiate a new")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// client for the BooksService. This client will be used to make the")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// appropriate calls to the BooksService methods.")]),t._v("\n\t\tbooksClient "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pbBooks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewBooksServiceClient")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("conn"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("blockquote",[e("p",[t._v("üö© If your IDE is giving any import errors, rerun "),e("code",[t._v("go mod tidy")]),t._v(".")])]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[e("strong",[t._v("Configure your environmental variables")])])]),t._v(" "),e("p",[t._v("In the above code, there are two usages of "),e("code",[t._v("os.Getenv(...)")]),t._v(". This is used to obtain environmental variables, which simplifies having multiple deployment environments by allowing us to declare these variables on deployment.")]),t._v(" "),e("p",[t._v("For the production environment, we will specify these when deploying. For the local environment, we make use of the "),e("code",[t._v("local.env")]),t._v(" file in the product ("),e("code",[t._v("ad")]),t._v(") directory. To ensure that your IDE is able to find the values in the "),e("code",[t._v("local.env")]),t._v(", ensure that you have "),e("a",{attrs:{href:""}},[t._v("installed and configured the correct plugins")]),t._v(".")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("local.env")]),t._v(" should contain the following content:")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# this file is used for local development purposes only")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# and should be used in conjunction with your IDE.")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Specifies the type of environment: 'development' or 'production'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# In the production environment this is automatically added to")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The Cloud Run service through the specification in the `cloudrun.tf`")]),t._v("\nALIS_OS_ENV=development\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The Google Project ID where the neuron will be hosted. This")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# is a product deployment and therefore requires a product deployment")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# to exist before it can be declared.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This can be found be running `alis product tree play.ad` and selecting")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# a deployment ID. We typically use a dev environment for local development")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# and testing.")]),t._v("\nALIS_OS_PROJECT=play"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ad"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dev"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v(".\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The Cloud Run hash of the br product deployment")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# that we have access to.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# For your own products, you can find this hash by opening")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# a Cloud Run instance and checking the URL.")]),t._v("\nALIS_OS_ME_CLOUDRUNHASH=z5x5ywf7za\n")])])]),t._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[e("strong",[t._v("Implement the gRPC server")])])]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("main()")]),t._v(" section in your "),e("code",[t._v("server.go")]),t._v(" contains all of the boilerplate code you require to simply run the server. Check that your "),e("code",[t._v("main()")]),t._v(" contains the exact following:")]),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tlog"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("Entry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Message"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"starting server..."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Severity"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" LogSeverity_NOTICE"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\tport "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" os"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Getenv")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PORT"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" port "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tport "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8080"')]),t._v("\n\t\tlog"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("Entry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Message"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Defaulting to port "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" port"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Severity"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" LogSeverity_WARNING"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tlistener"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" net"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Listen")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tcp"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('":"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("port"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlog"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fatalf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net.Listen: %v"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tgrpcServer "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" grpc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewServer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("grpc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("UnaryInterceptor")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serverInterceptor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tpb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("RegisterServiceServer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("grpcServer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("myService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" grpcServer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Serve")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("listener"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlog"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fatal")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("At this stage, your IDE might show an error for the section "),e("code",[t._v("pb.RegisterReceiptsServiceServer(grpcServer, &myService{})")]),t._v(". Navigate to the "),e("code",[t._v("methods.go")]),t._v(" file and ensure that the defintion for "),e("code",[t._v("myService")]),t._v(" is exactly the same as the following:")]),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create a Service object which we'll register with the Server")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" myService "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tpb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UnimplementedReceiptsServiceServer\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("ol",{attrs:{start:"4"}},[e("li",[e("strong",[t._v("Write tests for the methods")])])]),t._v(" "),e("p",[t._v("It is good practice to write tests prior to implementing code. In the "),e("code",[t._v("methods_test.go")]),t._v(" file, copy over the following code for us to test whether the implementation of the methods are behaving as expected.")]),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"context"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testing"')]),t._v("\n\n\tpb "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"go.protobuf.play.alis.exchange/play/ad/resources/receipts/v1"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"google.golang.org/genproto/googleapis/type/date"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Simulate a client object")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" client myService\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This init() function will only run when running Go tests.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Include a link to the file location of where the log originated from")]),t._v("\n\tlog"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetFlags")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("log"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Lshortfile"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\tclient "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" myService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("TestReceiptService_CreateReceipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("testing"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// You can run")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Construct a request message")]),t._v("\n\treq "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" pb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CreateReceiptRequest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Receipt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("pb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Receipt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tClient"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test@play.bar"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tBooks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"books/{book1}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"books/{book2}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tRequiredReturnDate"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("date"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Date"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tYear"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2023")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\tMonth"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\tDay"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Run a method")]),t._v("\n\tres"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateReceipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Background")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tfmt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("TestReceiptService_GetReceipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("testing"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Construct a request message")]),t._v("\n\treq "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" pb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GetReceiptRequest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"receipts/{insertReceiptID}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Run a method")]),t._v("\n\tres"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetReceipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Background")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tfmt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("ol",{attrs:{start:"5"}},[e("li",[e("strong",[t._v("Implement the methods")])])]),t._v(" "),e("p",[t._v("We will now implement the two methods for the "),e("code",[t._v("ReceiptService")]),t._v(".")]),t._v(" "),e("blockquote",[e("p",[t._v("ü§ì The code itself provides the detailed logic about what happens but the typical body of a method will include:")]),t._v(" "),e("ol",[e("li",[t._v("Some validation of the request arguments")]),t._v(" "),e("li",[t._v("Some interaction with APIs to obtain data, such as reading from a database or hitting another product's API.")]),t._v(" "),e("li",[t._v("Wrangling/use/update the obtained data based on the request arguments")]),t._v(" "),e("li",[t._v("Calling additional APIS with the wrangled data, such as to store the updated data.")]),t._v(" "),e("li",[t._v("Return a response")])])]),t._v(" "),e("p",[t._v("The code in "),e("code",[t._v("methods.go")]),t._v(" should be:")]),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"context"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"regexp"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"time"')]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/google/uuid"')]),t._v("\n\tpbBooks "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"go.protobuf.play.alis.exchange/play/br/resources/books/v1"')]),t._v("\n\tpb "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"go.protobuf.play.alis.exchange/play/ad/resources/receipts/v1"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"google.golang.org/genproto/googleapis/type/date"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"google.golang.org/grpc/codes"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"google.golang.org/grpc/status"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create a Service object which we'll register with the Server")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" myService "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tpb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UnimplementedReceiptsServiceServer\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("myService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateReceipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("pb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CreateReceiptRequest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("pb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Receipt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// validate that the requested books exist")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" book "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("range")]),t._v(" req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetReceipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetBooks")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" booksClient"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetBook")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("pbBooks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GetBookRequest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" book"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" status"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Errorf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("codes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("InvalidArgument"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"books %v not found."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" book"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Validate that the return date was specified")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetReceipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetRequiredReturnDate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" status"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Errorf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("codes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("InvalidArgument"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"return date must be specified."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Generate name for the receipt")]),t._v("\n\treq"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetReceipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Name "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"receipts/"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" uuid"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("New")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("String")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Generate the borrow date")]),t._v("\n\treq"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetReceipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BorrowDate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("date"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Date"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tYear"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("int32")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Now")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Year")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tMonth"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("int32")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Now")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Month")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tDay"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("int32")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Now")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Day")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" firestoreClient"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Doc")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetReceipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Create")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t\tctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\treq"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetReceipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" status"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Errorf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("codes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Internal"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"firestore related error: %v"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetReceipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("myService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetReceipt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("pb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GetReceiptRequest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("pb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Receipt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//validate request")]),t._v("\n\terr "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("validateArgument")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("`receipts\\/([0-9]){21}`")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// get data for the receipt")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" res pb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Receipt\n\tdocSnap"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" firestoreClient"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Doc")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" status"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Code")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" codes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NotFound "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" status"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Errorf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("codes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NotFound"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"resource (%s) not found"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\terr "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" docSnap"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("DataTo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" status"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Errorf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("codes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Internal"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GetReceipt: %v"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// validateArgument validates an argument and returns an error if not valid.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Good practice is to have separate files with utility functions such as this")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// but is added here for the sake of the example.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("validateArgument")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" regex "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// validate the Name field using regex")]),t._v("\n\tvalidateName "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" regexp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("MustCompile")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("regex"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tvalidatedName "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" validateName"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("MatchString")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("validatedName "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" status"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Errorf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t\t\tcodes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("InvalidArgument"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%s (%s) is not of the right format: %s"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" regex"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),e("ol",{attrs:{start:"6"}},[e("li",[e("strong",[t._v("Run the tests")])])]),t._v(" "),e("blockquote",[e("p",[t._v("üö© Before running the test, ensure that your build configuration is using the "),e("code",[t._v(".env")]),t._v(" file.")])]),t._v(" "),e("p",[t._v("... Should pass.")]),t._v(" "),e("p",[t._v("Now that we know that things are working, we need to make some final tweaks before we can build and deploy.")]),t._v(" "),e("ol",{attrs:{start:"7"}},[e("li",[e("strong",[t._v("Finishing touches")])])]),t._v(" "),e("p",[t._v("As we have noted, running "),e("code",[t._v("alis neuron genproto")]),t._v(" WITHOUT the "),e("code",[t._v("-p")]),t._v(" generates the definitions locally. We need to push these to the global definitions managed by "),e("strong",[t._v("alis.exchange")]),t._v(".")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("Remove local files")])])]),t._v(" "),e("p",[t._v("The locally compiled files need to be removed such as to not cause version control conflicts. In your terminal, navigate to the neuron's protobuf files by running")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/alis.exchange/play/protobuf/go/play/ad/resources/receipts/v1/\n")])])]),e("p",[t._v("Check that you are in the correct directory by running "),e("code",[t._v("ls")]),t._v(". The response should contain two files with "),e("code",[t._v(".pb.go")]),t._v(" ending.")]),t._v(" "),e("p",[t._v("Remove these files by runing "),e("code",[t._v("rm *")]),t._v(". Select yes if prompted whether to delete all the files.")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("Generate the definitions and push to repo")])])]),t._v(" "),e("p",[t._v("To compile the the proto and push it to the repo managed by "),e("strong",[t._v("alis.exchange")]),t._v(" run the following command from your terminal, inserting your resource name:")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("alis neuron genproto play.ad.resources-"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("yourResource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("-v1 -p\n")])])]),e("ul",[e("li",[e("strong",[t._v("Update Go mod to point to global definitions")])])]),t._v(" "),e("p",[t._v("In your "),e("code",[t._v("go.mod")]),t._v(" file, remove all the content such that the file looks similar to the example below")]),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[t._v("module play"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resources"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("receipts"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("v1\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("go")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.17")]),t._v("\n\nrequire "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),e("p",[t._v("If successful, your "),e("code",[t._v("go.mod")]),t._v(" should contain a "),e("code",[t._v("go.protobuf.play.alis.exchange")]),t._v(" entry under "),e("code",[t._v("require")]),t._v(".")]),t._v(" "),e("details",{staticClass:"custom-block details"},[e("summary",[t._v("Troubleshooting errors")]),t._v(" "),e("p",[t._v("Two common errors that users get at this stage are:")]),t._v(" "),e("ol",[e("li",[e("strong",[t._v("Module does not contain package")])])]),t._v(" "),e("p",[t._v("Typically follows the error message:")]),t._v(" "),e("div",{staticClass:"language-... module go.protobuf.play.alis.exchange@latest found (...), but does not contain package go.protobuf.play.alis.exchange/play/ad/resources/receipts/v1 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code")])]),e("p",[t._v("This means that your previous step of pushing the definitions to the repo was not successful. Perform the action in 2. again and retry running "),e("code",[t._v("go mod tidy")])]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[e("strong",[t._v("Unrecognized import path")])])]),t._v(" "),e("p",[t._v("Run the following command from the terminal and attempt "),e("code",[t._v("go mod tidy")]),t._v(" again.")]),t._v(" "),e("p",[t._v("go env -w GOPRIVATE=go.protobuf.play.alis.exchange")])]),t._v(" "),e("p",[t._v("We are now ready to build and deploy")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("Configure environmental variables")])])]),t._v(" "),e("p",[t._v("In the code, we have used various "),e("code",[t._v("os.Getenv()")]),t._v(" statements. In the production environment, these need to be available within the container at run time. To do this we need to:")]),t._v(" "),e("ul",[e("li",[e("em",[t._v("Declare the variable in Terraform")]),t._v("\nIn the neuron's directory within the "),e("code",[t._v("proto")]),t._v(" repo, we need to add variables to the "),e("code",[t._v("variables.tf")]),t._v(" file. This file contains variables that are automatically added and managed by "),e("strong",[t._v("alis.exchange")]),t._v(" as well as a set of custom, user defined variables. Add the following variables to the file:")])]),t._v(" "),e("div",{staticClass:"language-hcl extra-class"},[e("pre",{pre:!0,attrs:{class:"language-hcl"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Custom neuron specific ENVS:")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("variable"),e("span",{pre:!0,attrs:{class:"token type variable"}},[t._v(' "ALIS_OS_ME_CLOUDRUNHASH" ')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("ul",[e("li",[e("em",[t._v("Add the variable to the container")]),t._v("\nIn the "),e("code",[t._v("cloudrun.tf")]),t._v(" file check that the "),e("code",[t._v("containers")]),t._v(" section contains the following specification:")])]),t._v(" "),e("div",{staticClass:"language-hcl extra-class"},[e("pre",{pre:!0,attrs:{class:"language-hcl"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),e("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"google_cloud_run_service"')])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Other content")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("containers")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"europe-west1-docker.pkg.dev/'),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("ALIS_OS_PRODUCT_PROJECT")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("/neurons/"),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("ALIS_OS_NEURON")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(":"),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("ALIS_OS_NEURON_VERSION_COMMIT_SHA")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("env")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ALIS_OS_PROJECT"')]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("value")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.ALIS_OS_PROJECT\n\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("env")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ALIS_OS_ENV"')]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("value")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"production"')]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("env")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ALIS_OS_PROJECT"')]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("value")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.ALIS_OS_PROJECT\n\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("env")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ALIS_OS_ME_CLOUDRUNHASH"')]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("value")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.ALIS_OS_ME_CLOUDRUNHASH\n\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resources")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("limits")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tcpu: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1000m"')]),t._v("\n\t\t\tmemory: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2Gi"')]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Other content")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h4",{attrs:{id:"üèÉ‚Äç‚ôÇ-ex-8-build-the-neuron"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#üèÉ‚Äç‚ôÇ-ex-8-build-the-neuron"}},[t._v("#")]),t._v(" üèÉ‚Äç‚ôÇ Ex 8: Build the neuron")]),t._v(" "),e("ol",[e("li",[t._v("Ensure that all files in both the "),e("code",[t._v("proto")]),t._v(" and "),e("code",[t._v("products/ad")]),t._v(" have been added to Git.")]),t._v(" "),e("li",[t._v("Commit and push all files that you have worked on in the neuron.")]),t._v(" "),e("li",[e("strong",[t._v("Build the neuron")])])]),t._v(" "),e("p",[t._v("In your terminal, run the following command, specifying your neuron name:")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("alis neuron build play.ad.resources-"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("yourResource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("-v1\n")])])]),e("blockquote",[e("p",[t._v("ü§ì In the background, "),e("strong",[t._v("alis.exchange")]),t._v(" performs various actions:"),e("br")]),t._v(" "),e("ul",[e("li",[t._v("A tag is added to the latest commit in the "),e("code",[t._v("proto")]),t._v(" repo. This is used to know what the state of the proto and infrastructure was when the "),e("code",[t._v("build")]),t._v(" took place."),e("br")]),t._v(" "),e("li",[t._v("The CLI looks for one or more "),e("em",[t._v("Dockerfile")]),t._v(" in the "),e("code",[t._v("products/ad/resources/.../v1")]),t._v(" directory."),e("br")]),t._v(" "),e("li",[t._v("If these files are present, these are executed within the "),e("em",[t._v("product project")]),t._v(" (play-lb-product-msc6ohw) "),e("a",{attrs:{href:"https://console.cloud.google.com/cloud-build/builds?project=play-ad-product-msc6ohw",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cloud Build"),e("OutboundLink")],1),t._v(", which build the container images and places these on\n"),e("a",{attrs:{href:"https://cloud.google.com/artifact-registry",target:"_blank",rel:"noopener noreferrer"}},[t._v("Artifact Registry"),e("OutboundLink")],1),t._v(" within the "),e("em",[t._v("product project")]),t._v(" (play-lb-product-msc6ohw)."),e("br")]),t._v(" "),e("li",[t._v("Updates the resources in the "),e("strong",[t._v("alis.exchange")]),t._v(" operating system such as to reflect the changes.")])])]),t._v(" "),e("p",[t._v("At this stage, the image has been created but it is not yet available for usage by anyone. To make it accessible, it needs to be deployed to a "),e("code",[t._v("product deployment")]),t._v(".")]),t._v(" "),e("h4",{attrs:{id:"üèÉ‚Äç‚ôÇ-ex-9-deploy-the-neuron"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#üèÉ‚Äç‚ôÇ-ex-9-deploy-the-neuron"}},[t._v("#")]),t._v(" üèÉ‚Äç‚ôÇ Ex 9: Deploy the neuron")]),t._v(" "),e("p",[t._v("From the terminal, run the following command, specifying your neuron name:")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("alis neuron deploy play.ad.resource-"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("yourResource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("-v1 -e\n")])])]),e("p",[t._v("The "),e("code",[t._v("-e")]),t._v(" is added to specify environmental variables for the production environment.")]),t._v(" "),e("ul",[e("li",[t._v("Follow the prompts and deploy the neuron to the existing product deployment.")]),t._v(" "),e("li",[t._v("When asked to add an environmental variable, add "),e("code",[t._v("ALIS_OS_ME_CLOUDRUNHASH")]),t._v(" with the value of "),e("code",[t._v("z5x5ywf7za")]),t._v(". The other environmental variables are added automatically by "),e("strong",[t._v("alis.exchange")]),t._v(".")])]),t._v(" "),e("blockquote",[e("p",[t._v("ü§ì In the background, "),e("strong",[t._v("alis.exchange")]),t._v(" retrieves the neuron's Terraform specification from the commit history at the point in time when the "),e("code",[t._v("build")]),t._v(" was run and applies the specification from the "),e("em",[t._v("product project")]),t._v(" (play-lb-product-msc6ohw), which has the relevant permissions to manage deployments. This can also be viewed in the "),e("a",{attrs:{href:"https://console.cloud.google.com/cloud-build/builds?project=play-ad-product-msc6ohw",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cloud Build logs"),e("OutboundLink")],1),t._v("."),e("br"),t._v("\nScan throught the "),e("code",[t._v("*.tf")]),t._v(" files to see what all is performed. It is valuable to know that in the "),e("code",[t._v("cloudrun.tf")]),t._v(" a new Cloud Run service is created and the container built in the previous step is managed by the Cloud Run.")])]),t._v(" "),e("p",[t._v("Once the deployment has taken place, your neuron is in production üöÄ")])])}),[],!1,null,null,null);s.default=n.exports}}]);